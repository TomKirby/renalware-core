machine:
  pre:
    - sudo curl --output /usr/local/bin/phantomjs https://s3.amazonaws.com/circle-downloads/phantomjs-2.1.1

dependencies:
  post:
    - bundle exec bundle-audit update && bundle exec bundle-audit check

test:
  override:
    #- bundle exec rspec spec --format progress
    - mkdir -p $CIRCLE_TEST_REPORTS/cucumber
    - bundle exec cucumber --format progress --format json --out $CIRCLE_TEST_REPORTS/cucumber/cucumber.cucumber

  post:
    # - bundle exec rake cucumber:web:
    #   environment:
    #     RAILS_ENV: test
    #     TEST_DEPTH: web
    - bundle exec codeclimate-test-reporter
    - bin/rails db:environment:set db:migrate:reset db:seed RAILS_ENV=test:
       environment:
         DEMO: true


