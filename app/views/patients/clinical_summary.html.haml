.row.g-center
  %h5.fi-graph-trend
    = "Clinical Summary for #{@patient.full_name} - KCH: #{@patient.local_patient_id}, Age: #{@patient.age}, Sex: #{I18n.t("enums.gender.#{@patient.sex}")}, DoB: #{@patient.dob}, Modal: "

.clinical-summary
  .columns.large-6.small-6
    %h5 
      = link_to "#{@patient.problems.length} Problems", problems_patient_path(@patient)

      %ul.no-bullet
        - @patient.problems.each do |p|
     
          %li
            = "#{p.description}, #{p.created_at.strftime("%d/%m/%Y")}, #{p.user_id}"
                      
.clinical-summary
  .columns.large-6
    %h5
      = link_to "#{@patient.patient_medications.length} Current Medications", medications_index_patient_path(@patient)

      %ul.no-bullet
        - @patient.patient_medications.each do |p|
     
          %li{:class => "drug-#{p.medication.type.downcase}"}
            
            = "#{p.medication.type}, #{p.medication.name}, #{p.dose}, #{I18n.t("enums.route.#{p.route}")}, #{p.frequency}, #{p.date}"          

.clinical-summary
  .columns.large-12.small-12
    %table.responsive
      %caption 
        = link_to "#{@patient.patient_events.length} Patient Events", patient_patient_events_path(@patient)

      %thead
        %th
          Added
        %th
          Event Type
        %th.table-description
          Description
        %th
          User

      %tbody
        - @patient.patient_events.each do |event|
          %tr
            %td{:data => { :heading => "Added" }}
              = event.created_at
            %td{:data => { :heading => "Event Type"}}
              = event.patient_event_type.name
            %td{:data => { :heading => "Description"}}
              %dl.accordion{data: {accordion: true} }
                %dd.accordion-navigation
                  %a.fi-plus.fi-minus.toggle-notes{:id => "patient-event-notes-#{event.id}", href: "#patient-event-notes-#{event.id}"}
                    = event.description
                  .content.toggle-content{:id => "patient-event-notes-#{event.id}"}  
                    = event.notes
            %td{:data => { :heading => "User"}}
              / TODO
          
.clinical-summary
  = content_for :secondary_nav do  
    = render partial: "patients/clin_sum_sub_nav", locals: { model: @patient }

