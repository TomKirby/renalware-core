%table.responsive
  %thead
    %th.table-width
      Diagnosis Date
    %th.table-width
      Start Treatment Date
    %th.table-width
      End Treatment Date
    %th.table-width
      Causes/ Symptoms
    %th.table-width
      Organisms
    %th.table-width
      Episode Type
    %th.table-width
      White Cell Count
    %th.table-width
      Antibiotics/Routes
    %th.table-width
      Last Updated
    %th.table-width.g-center{colspan: "2"}
      Action

  %tbody
    - @peritonitis_episodes.each do |p|
      %tr{ valign: "top" }
        %td{ :data => { :heading => "Diagnosis Date" }, valign: "top" }
          = p.diagnosis_date.strftime("%d/%m/%Y")
        %td{ :data => { :heading => "Start Date"}, valign: "top" }
          = p.start_treatment_date.strftime("%d/%m/%Y")
        %td{ :data => { :heading => "End Date"}, valign: "top" }
          = p.end_treatment_date.strftime("%d/%m/%Y")
        %td{ :data => { :heading => "Organisms"}, valign: "top" }
          %ul.no-bullet.table-data-list
            %li
              = "Line Break: #{p.line_break.yesno},"
            %li
              = "Exit Site Infection: #{p.exit_site_infection.yesno}"
            %li
              = "Diarrhoea: #{p.diarrhoea.yesno}"
            %li
              = "Abdominal Pain: #{p.abdominal_pain.yesno}"
            %li
              = "Fluid Description: #{p.fluid_description.description}"

        %td{ :data => { :heading => "Organisms"}, valign: "top" }
          %dl.accordion{ data: { accordion: true } }
            %dd.accordion-navigation
              %a.toggle-info{ :id => "patient-peritonitis-toggle-#{p.id}", href: "#patient-peritonitis-toggle-#{p.id}" }
                View
              .content{ :id => "patient-peritonitis-toggle-#{p.id}" }
                %ul.no-bullet.toggle-content
                  %li
                    = organism_and_sensitivity(p.infection_organisms)

        %td{ :data => { :heading => "Episode Type"}, valign: "top" }
          %dl.accordion{ data: { accordion: true } }
            %dd.accordion-navigation
              %a.toggle-info{ :id => "patient-peritonitis-toggle-#{p.id}", href: "#patient-peritonitis-toggle-#{p.id}" }
                = p.episode_type.blank? ? "Unknown": p.episode_type.term
              .content.toggle-content{ :id => "patient-peritonitis-toggle-#{p.id}" }
                = "Catheter Removed: #{p.catheter_removed}"

        / %td{:data => { :heading => "Description" }, valign: "top"}
        /   %dl.accordion{ data: { accordion: true } }
        /     %dd.accordion-navigation
        /       %a.toggle-info{ :id => "patient-peritonitis-toggle-#{p.id}", href: "#patient-peritonitis-toggle-#{p.id}" }
        /         View
        /       .content.toggle-content{ :id => "patient-peritonitis-toggle-#{p.id}" }
        /         = p.notes

        %td{ :data => { :heading => "White Cell Count"}, valign: "top" }
          %dl.accordion{ data: { accordion: true } }
            %dd.accordion-navigation
              %a.toggle-info{ :id => "patient-peritonitis-toggle-#{p.id}", href: "#patient-peritonitis-toggle-#{p.id}" }
                = "Total: #{p.white_cell_total}"
              .content{ :id => "patient-peritonitis-toggle-#{p.id}" }
                %ul.no-bullet.toggle-content
                  %li
                    = "Neutro: #{p.white_cell_neutro}%,"
                  %li
                    = "Lympho: #{p.white_cell_lympho}%,"
                  %li
                    = "Degen: #{p.white_cell_degen}%,"
                  %li
                    = "Other: #{p.white_cell_other}%"

        %td{ :data => { :heading => "Antibiotics/ Routes"}, valign: "top" }
          %dl.accordion{ data: { accordion: true } }
            %dd.accordion-navigation
              %a.toggle-info{ :id => "patient-peritonitis-toggle-#{p.id}", href: "#patient-peritonitis-toggle-#{p.id}" }
                View
              .content.toggle-content{ :id => "patient-peritonitis-toggle-#{p.id}" }
                %ul.no-bullet
                  %li.toggle-content
                    = medication_and_route(p.medications)

        %td{ :data => { :heading => "Last Updated" }, valign: "top" }
          = p.updated_at.strftime("%d/%m/%Y, %H:%M")

        %td{ :data => { :heading => "Action" }, valign: "top" }
          = link_to "Update", edit_patient_peritonitis_episode_path(@patient, p.id)
