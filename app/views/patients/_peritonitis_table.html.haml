%table.responsive
  %thead
    %tr
      %th.column-6-width
        Diagnosis Date
      %th.column-6-width
        Treatment Start Date
      %th.column-6-width
        Treatment End Date
      %th
        Outcome
      %th
        Organisms
      %th.column-9-width
        White Cell Count
      %th
        Causes/Symptoms
      %th
        Antibiotics/Routes
      %th
        Notes
      %th.column-6-width
        Last Updated
      %th
        Action

  %tbody
    - @peritonitis_episodes.each do |p|
      %tr{ valign: "top" }

        %td{ :data => { :heading => "Diagnosis Date" }, valign: "top" }
          = p.diagnosis_date

        %td{ :data => { :heading => "Start Treatment Date" }, valign: "top" }
          = p.treatment_start_date

        %td{ :data => { :heading => "End Treatment Date" }, valign: "top" }
          = default_for_blank(p.treatment_end_date, "Pending")

        %td{ :data => { :heading => "Episode Type" }, valign: "top" }
          %ul.table-data-list
            %li
              Episode Type:
              = default_for_associated(p.episode_type, :term, "Unknown")
            %li
              = "Catheter Removed: #{yes_no(p.catheter_removed)}"

        %td{ :data => { :heading => "Organisms" }, valign: "top" }
          %ul.table-data-list
            = organisms(p.infection_organisms)

        %td{ :data => { :heading => "White Cell Count" }, valign: "top" }
          %ul.table-data-list
            %li
              = "Total: #{p.white_cell_total}"
            %li
              = "Neutro: #{p.white_cell_neutro}%"
            %li
              = "Lympho: #{p.white_cell_lympho}%"
            %li
              = "Degen: #{p.white_cell_degen}%"
            %li
              = "Other: #{p.white_cell_other}%"

        %td{ :data => { :heading => "Causes/Symptoms" }, valign: "top" }
          %ul.table-data-list
            %li
              = "Line Break: #{yes_no(p.line_break)}"
            %li
              = "Exit Site Infection: #{yes_no(p.exit_site_infection)}"
            %li
              = "Diarrhoea: #{yes_no(p.diarrhoea)}"
            %li
              = "Abdominal Pain: #{yes_no(p.abdominal_pain)}"
            %li
              = "Fluid Description: #{p.fluid_description}"

        %td{ :data => { :heading => "Antibiotics/Routes" }, valign: "top" }
          %ul.table-data-list
            = medication_and_route(p.medications)

        %td{:data => { :heading => "Notes" }, valign: "top" }
          = p.notes

        %td{ :data => { :heading => "Last Updated" }, valign: "top" }
          = p.updated_at

        %td{ :data => { :heading => "Action" }, valign: "top" }
          %ul.table-data-list
            %li
              = link_to "Update", edit_patient_peritonitis_episode_path(@patient, p.id), class: "update-pe", id: "update-pe-#{p.id}"
            %li
              = link_to "View Episode", patient_peritonitis_episode_path(@patient, p.id), class: "view-pe", id: "view-pe-#{p.id}"

